# 双人对抗单词闯关游戏 - 产品需求文档 (PRD) v1.0 简化版

## 📋 文档信息
- **版本**: v1.0 (MVP版本)
- **创建日期**: 2024年12月
- **产品名称**: 单词闯关 - 双人对抗版
- **目标用户**: 小学三年级至高中学生
- **开发周期**: 6-8周

## 🎯 产品概述

### 产品定位
将现有的单人单词学习游戏升级为在线双人对抗游戏，通过融合经典小游戏的方式，让单词学习更具趣味性和竞技性。

### 核心价值
- **学习效果**: 通过对抗激发学习动力，提高记忆效果
- **游戏化**: 将枯燥的背单词转化为有趣的竞技游戏
- **实时互动**: 双人实时对战，增加紧张感和成就感

### MVP版本范围
**包含功能**:
- 简单用户注册（昵称+年级）
- 快速匹配系统
- 三关卡双人对战
- 三个核心小游戏
- 基础战绩显示

**暂不包含**:
- 第三方登录（微信、QQ）
- 好友系统
- 排行榜
- 成就系统
- 商店系统
- 复杂的用户档案

## 🎮 核心功能

### 1. 用户系统（简化版）
#### 1.1 快速注册
- **昵称输入**: 用户输入昵称（3-8个字符）
- **年级选择**: 下拉选择年级（三年级到高三）
- **头像系统**: 提供8个预设头像供选择
- **本地存储**: 用户信息存储在本地，支持换设备重新注册

#### 1.2 用户信息
- **基础信息**: 昵称、年级、头像
- **游戏统计**: 总场次、胜场、败场、胜率
- **当前状态**: 在线/离线、游戏中/空闲

### 2. 匹配系统（简化版）
#### 2.1 快速匹配
- **同年级匹配**: 优先匹配相同年级的玩家
- **跨年级匹配**: 等待超过30秒后，匹配相邻年级
- **匹配超时**: 等待超过60秒提示重新匹配
- **取消匹配**: 支持用户主动取消匹配

#### 2.2 匹配逻辑
- **匹配池**: 按年级分组的匹配队列
- **匹配算法**: 先进先出，优先同年级
- **房间创建**: 匹配成功后自动创建游戏房间

### 3. 游戏系统（核心）
#### 3.1 游戏流程
1. **匹配成功** → 显示对手信息
2. **准备阶段** → 5秒倒计时
3. **关卡一** → 随机小游戏 + 答题
4. **关卡二** → 随机小游戏 + 答题
5. **关卡三** → 随机小游戏 + 答题
6. **结果显示** → 胜负判定 + 数据统计

#### 3.2 答题机制
- **题目来源**: 使用现有词库，按年级加载
- **题目数量**: 每关卡10道题
- **答题时间**: 每题15秒限时
- **答题方式**:
  - 关卡一：中译英（填空）
  - 关卡二：英译中（选择题）
  - 关卡三：听音辨词（填空）

#### 3.3 小游戏融合
每个关卡随机选择一个小游戏，答题结果影响小游戏进度：
- **答对**: 小游戏中获得优势
- **答错**: 小游戏中失去优势或对手获得优势

### 4. 小游戏库（精选3个）
#### 4.1 警察抓小偷 (关卡一专用)
- **游戏机制**: 警察追捕小偷，双方在跑道上移动
- **答题联动**: 答对前进1步，答错后退1步
- **胜负条件**: 警察追上小偷获胜，小偷到达终点获胜
- **视觉效果**: 卡通警察和小偷角色，跑道长度20格

#### 4.2 登天梯 (关卡二专用)
- **游戏机制**: 双方攀爬天梯，比拼高度
- **答题联动**: 答对上升1层，答错下降1层
- **胜负条件**: 先到达20层者获胜，或最终高度更高者获胜
- **视觉效果**: 梯子和攀爬角色，实时显示高度

#### 4.3 词力拔河 (关卡三专用)
- **游戏机制**: 拔河比赛，绳子中心点左右移动
- **答题联动**: 答对拉绳2格，答错对方得1格
- **胜负条件**: 将绳子拉过己方8格线获胜
- **视觉效果**: 拔河绳子和两方角色，动态绳子位置

## 📱 页面设计详细说明

### 1. 欢迎页面 (welcome.html) - 基于现有界面升级
#### 页面布局 (保留现有设计，增加对战模式选择)
```
┌─────────────────────────────────────┐
│              单词闯关               │
│            (保持现有动画)            │
├─────────────────────────────────────┤
│                                     │
│    ┌─────────────────────────┐      │
│    │      [单人挑战]          │      │
│    │    (保留原有功能)         │      │
│    └─────────────────────────┘      │
│                                     │
│    ┌─────────────────────────┐      │
│    │      [双人对战]          │      │
│    │      (新增功能)          │      │
│    └─────────────────────────┘      │
│                                     │
│    网络状态: ✅ 网络连接正常          │
│                                     │
│                        [设置] ⚙️    │
└─────────────────────────────────────┘
```

#### 页面元素详细说明
1. **保留现有元素**
   - 游戏标题: "单词闯关"，保持现有的6xl/8xl字体和动画
   - 背景渐变: 保持现有的紫色渐变背景
   - 网络状态提示: 保留现有的网络检查功能
   - 管理员入口: 保留右上角的设置图标

2. **新增游戏模式选择**
   - 单人挑战按钮: 保持原有的"开始挑战!"功能和样式
   - 双人对战按钮: 新增，相同样式但不同颜色(蓝色背景)
   - 按钮尺寸: 保持现有的py-6 px-16规格

3. **交互逻辑**
   - 单人挑战: 跳转到现有的info_input.html
   - 双人对战: 跳转到新的battle_info_input.html

### 2. 双人对战信息输入页面 (battle_info_input.html) - 基于现有info_input.html
#### 页面布局 (保留现有设计，简化功能)
```
┌─────────────────────────────────────┐
│            准备双人对战！            │
│          (保持现有样式)            │
├─────────────────────────────────────┤
│                                     │
│    输入你的昵称:                    │
│    ┌─────────────────────────┐      │
│    │ 例如：单词小王子         │      │
│    └─────────────────────────┘      │
│                                     │
│    选择你的年级:                    │
│    [三年级] [四年级] [五年级]       │
│    [六年级] [七年级] [八年级]       │
│    [九年级] [高一] [高二/高三]     │
│                                     │
│    ┌─────────────────────────┐      │
│    │      [开始匹配]          │      │
│    └─────────────────────────┘      │
│                                     │
└─────────────────────────────────────┘
```

#### 页面元素详细说明
1. **保留现有设计**
   - 背景游戏: 保持现有的蓝色到粉色渐变
   - 卡片样式: 保持现有的半透明白色卡片设计
   - 输入框样式: 保持现有的圆角输入框设计
   - 年级按钮: 保持现有的网格布局和选中效果

2. **简化功能**
   - 移除头像选择: 使用默认头像或随机分配
   - 保留昵称和年级选择: 核心功能不变
   - 按钮文字: 从"确认开始"改为"开始匹配"

### 3. 匹配等待页面 (matching.html)
#### 页面布局
```
┌─────────────────────────────────────┐
│              正在匹配               │
│                                     │
│         [旋转动画图标]              │
│                                     │
│        寻找同年级对手中...           │
│                                     │
│        等待时间: 25秒                │
│                                     │
│    ┌─────────────────────────┐      │
│    │        [取消匹配]        │      │
│    └─────────────────────────┘      │
│                                     │
│              匹配信息               │
│        昵称: 小明                   │
│        年级: 五年级                 │
│        胜率: 75% (3胜1负)           │
│                                     │
└─────────────────────────────────────┘
```

#### 页面元素详细说明
1. **匹配状态**
   - 标题: "正在匹配"，24px字体
   - 动画图标: CSS旋转动画
   - 状态文字: 动态更新匹配状态

2. **等待信息**
   - 倒计时显示: 60秒倒计时
   - 匹配策略提示: 30秒后扩大匹配范围

3. **用户信息**
   - 显示当前用户的基本信息和战绩

### 3. 对战准备页面 (battle-ready.html)
#### 页面布局
```
┌─────────────────────────────────────┐
│              找到对手！             │
├─────────────────────────────────────┤
│                                     │
│  [我的头像]              [对手头像]  │
│    我的昵称                对手昵称  │
│   五年级                   五年级    │
│   胜率: 75%                胜率: 68% │
│                                     │
├─────────────────────────────────────┤
│              游戏信息               │
│                                     │
│    关卡一: 警察抓小偷 (中译英)       │
│    关卡二: 登天梯 (英译中)           │
│    关卡三: 词力拔河 (听音辨词)       │
│                                     │
│    词库: 五年级上册                 │
│    每关: 10道题                     │
│                                     │
├─────────────────────────────────────┤
│                                     │
│        倒计时: 3秒后开始             │
│                                     │
└─────────────────────────────────────┘
```

#### 页面元素详细说明
1. **对手信息对比**
   - 左右对称布局显示双方信息
   - 头像: 80x80px圆形头像
   - 昵称、年级、胜率信息

2. **游戏信息**
   - 显示三个关卡对应的小游戏
   - 词库和题目数量信息

3. **倒计时**
   - 5秒倒计时自动开始游戏

### 4. 对战界面 (battle.html)
#### 页面布局
```
┌─────────────────────────────────────┐
│  [我] 小明 5/10  VS  小红 3/10 [对手]│
├─────────────────────────────────────┤
│                                     │
│        小游戏区域 (动态内容)         │
│                                     │
│    ┌─────────────────────────┐      │
│    │                         │      │
│    │     警察抓小偷游戏        │      │
│    │                         │      │
│    │  👮‍♂️ ←─────→ 🏃‍♂️         │      │
│    │  位置: 5    位置: 8      │      │
│    └─────────────────────────┘      │
│                                     │
├─────────────────────────────────────┤
│              答题区域               │
│                                     │
│    题目: apple                      │
│    中文意思是?                      │
│                                     │
│    ┌─────────────────────────┐      │
│    │      [输入答案]          │      │
│    └─────────────────────────┘      │
│                                     │
│    [确认] | 剩余时间: 12秒           │
│                                     │
├─────────────────────────────────────┤
│    关卡: 1/3 | 题目: 5/10           │
└─────────────────────────────────────┘
```

#### 页面元素详细说明
1. **对战状态栏**
   - 双方昵称和当前得分
   - 实时更新对战状态

2. **小游戏区域**
   - 动态加载不同的小游戏界面
   - 根据答题结果实时更新游戏状态
   - 尺寸: 350x200px

3. **答题区域**
   - 题目显示: 18px字体，居中显示
   - 答案输入框: 280x45px
   - 确认按钮和倒计时

4. **进度信息**
   - 当前关卡和题目进度
   - 底部固定显示

### 5. 游戏结果页面 (battle-result.html) - 基于现有result页面整合
#### 页面布局 (保留现有的错题汇总等关键功能)
```
┌─────────────────────────────────────┐
│              游戏结束               │
│                                     │
│            🏆 胜利! 🏆              │
│          (保持现有样式)            │
├─────────────────────────────────────┤
│              对战结果               │
│                                     │
│  [我的头像]              [对手头像]  │
│    小明                    小红      │
│   总分: 8                 总分: 6    │
│   用时: 3分25秒           用时: 4分12秒│
│                                     │
├─────────────────────────────────────┤
│              关卡详情               │
│                                     │
│  关卡一 (警察抓小偷):     胜利 ✓     │
│  关卡二 (登天梯):         失败 ✗     │
│  关卡三 (词力拔河):       胜利 ✓     │
│                                     │
├─────────────────────────────────────┤
│            错题回顾 (保留)            │
│                                     │
│  关卡：1                            │
│  题目：apple                        │
│  正确答案：苹果                    │
│  你的回答：橙子                    │
│                                     │
│  关卡：3                            │
│  题目：hello                        │
│  正确答案：你好                    │
│  你的回答：大家好                  │
│                                     │
├─────────────────────────────────────┤
│                                     │
│  [再来一局] [返回首页]               │
│                                     │
└─────────────────────────────────────┘
```

#### 页面元素详细说明
1. **保留现有的核心功能**
   - 胜负标题: 保持现有的"挑战成功!"/"挑战失败"样式
   - 背景设计: 保持现有的渐变背景和动画效果
   - 用户信息: 保留昵称和年级显示
   - 统计数据: 保留答对题目、总题目数、总用时显示

2. **重点保留：错题汇总功能**
   - 保持现有的错题回顾区域设计
   - 保留现有的滚动区域和样式
   - 显示格式: 关卡、题目、正确答案、用户答案
   - 错题项样式: 保持现有的卡片式设计和颜色区分

3. **新增对战元素**
   - 对手信息对比: 双方昵称、得分、用时对比
   - 关卡胜负情况: 每个关卡的小游戏结果
   - 对战统计: 双方的答题数据对比

4. **操作按钮**
   - 保留现有的"返回首页"按钮样式
   - 新增"再来一局"按钮，直接进入匹配

## 🎯 用户体验流程

### 首次使用流程 (基于现有流程扩展)
1. 用户打开游戏 → 欢迎页面 (保持现有设计)
2. 选择游戏模式 → 点击"双人对战"按钮
3. 进入对战信息输入页 → 输入昵称、选择年级 (基于现有info_input设计)
4. 点击"开始匹配" → 进入匹配等待页面
5. 匹配成功 → 查看对手信息和游戏规则
6. 5秒倒计时 → 开始第一关卡 (基于现有level页面改造)
7. 完成三个关卡 → 查看游戏结果 (基于现有result页面整合)
8. 查看错题汇总 (保留现有功能) → 选择再来一局或返回首页

### 日常使用流程 (兼容现有功能)
1. 打开游戏 → 欢迎页面 (可选择单人或双人模式)
2. 单人模式 → 保持现有的完整流程不变
3. 双人模式 → 进入匹配流程
4. 完成对战 → 查看结果和错题分析

## 📊 数据统计需求 (基于现有数据结构扩展)

### 用户数据 (保留现有结构)
- **基础数据**: 昵称、年级 (保持与现有系统一致)
- **游戏统计**: 在现有统计基础上增加双人对战数据
- **答题统计**: 保留现有的答题记录结构和统计方式

### 游戏数据 (扩展现有结构)
- **对战数据**: 在现有challengeResults基础上增加对手信息
- **关卡数据**: 保留现有的关卡统计，增加小游戏结果
- **小游戏数据**: 新增小游戏表现统计

### 学习效果数据 (保留现有功能)
- **错题记录**: 保持现有的wrongAnswers数据结构不变
- **错误统计**: 保留现有的错题分析功能
- **进步跟踪**: 保持现有的学习进度记录方式

## 🔧 技术要求 (基于现有技术栈升级)

### 前端要求 (保持现有技术栈)
- 基于现有Web项目升级，保持Tailwind CSS和Vanilla JS
- 保持现有的iframe架构和导航机制
- 保留现有的音频系统和动画效果
- 新增WebSocket实时通信模块
- 保持现有的localStorage数据存储机制

### 后端要求 (最小化新增)
- WebSocket服务器 (使用Node.js + Socket.io)
- 简单的用户数据存储 (优先使用内存或简单数据库)
- 匹配队列管理 (基于内存队列)
- 游戏房间管理 (使用Socket.io房间功能)

### 性能要求 (保持现有标准)
- 页面加载时间 < 3秒 (保持现有性能)
- 实时通信延迟 < 200ms
- 支持并发用户数 > 100 (MVP阶段足够)

## 🎯 成功指标

### 短期目标 (2个月)
- **用户规模**: 注册用户数 > 500
- **活跃度**: 日活跃用户数 > 50
- **参与度**: 用户平均游戏时长 > 10分钟
- **留存率**: 次日留存率 > 30%

### 技术指标
- **稳定性**: 系统可用性 > 99%
- **性能**: 匹配成功率 > 90%
- **用户体验**: 用户满意度 > 4.0/5.0

## 🚀 开发计划 (基于现有代码库升级)

### 第1-2周：界面整合和基础架构
- 修改welcome.html，增加双人对战按钮
- 复制info_input.html为battle_info_input.html并简化
- 搭建基础WebSocket服务器
- 设计匹配系统数据结构

### 第3-4周：游戏逻辑和小游戏
- 开发三个小游戏的前端展示组件
- 实现双人对战逻辑和状态同步
- 整合现有的答题系统和评分机制
- 修改level页面，增加小游戏显示区域

### 第5-6周：结果页面和功能完善
- 整合result页面，保留错题汇总功能
- 开发matching.html和battle-ready.html
- 完善实时通信和断线重连
- 集成现有的音频系统

### 第7-8周：测试优化和上线
- 全面功能测试，确保单人和双人模式都正常
- 性能优化和网络优化
- 部署到生产环境并进行用户测试
- 文档完善和交付准备

## 📋 风险控制

### 技术风险
- **WebSocket稳定性**: 准备轮询降级方案
- **并发处理**: 限制同时在线用户数
- **数据同步**: 实现断线重连机制

### 用户体验风险
- **匹配等待**: 提供单机练习模式
- **网络不稳定**: 优化弱网环境体验
- **学习曲线**: 简化操作流程

### 运营风险
- **用户获取**: 依靠现有用户推广
- **内容质量**: 使用现有成熟词库
- **技术支持**: 建立简单的反馈机制

---

## 📋 与现有系统的兼容性说明

### 保留的现有功能
1. **完整的单人游戏模式**: 保持现有的所有单人挑战功能不变
2. **错题汇总系统**: 完全保留现有的错题回顾和分析功能
3. **音频系统**: 保留现有的音效和TTS功能
4. **管理员系统**: 保留现有的管理员配置功能
5. **数据结构**: 保持现有的localStorage数据格式兼容
6. **界面设计**: 保留现有的视觉风格和动画效果

### 升级的功能
1. **欢迎页面**: 增加游戏模式选择，但保持原有设计风格
2. **结果页面**: 在现有基础上增加对战元素，保留错题汇总
3. **导航系统**: 保持现有的iframe导航机制
4. **数据统计**: 在现有统计基础上扩展双人对战数据

### 新增的功能
1. **双人对战模式**: 全新的匹配和对战系统
2. **小游戏系统**: 三个融合答题的小游戏
3. **实时通信**: WebSocket实时对战功能
4. **匹配系统**: 基于年级的智能匹配

### 技术兼容性
- **代码复用**: 最大化复用现有代码，减少重写工作
- **数据兼容**: 新数据结构向下兼容现有数据
- **功能隔离**: 单人和双人模式完全独立，互不影响
- **渐进升级**: 可以分阶段发布，先发布基础功能

---

**文档版本**: v1.0 (MVP - 基于现有系统升级)
**最后更新**: 2024年12月
**负责人**: 产品团队
**开发周期**: 6-8周
**目标**: 在保持现有功能的基础上，验证双人对抗玩法的可行性
