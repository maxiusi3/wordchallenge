<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¬¢è¿ - å•è¯é—¯å…³</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- å¼•å…¥ Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* å¯ä»¥æ·»åŠ ä¸€äº›é’ˆå¯¹æ­¤é¡µé¢çš„ç‰¹å®š Kahoot é£æ ¼åŒ– */
        html {
            background-color: transparent; /* ç¡®ä¿ body èƒŒæ™¯èƒ½å®Œå…¨æ˜¾ç¤º */
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden; /* Prevent scrollbars on html element itself */
        }
        body {
            /* Kahoot-like gradient or bright color */
            background: linear-gradient(135deg, #864cbf 0%, #4f46e5 100%);
            font-family: 'Arial', sans-serif; /* Or a more playful font if available */
            overflow: hidden; /* é˜²æ­¢å†…éƒ¨æ»šåŠ¨ */
            margin: 0; /* Ensure no default body margin */
        }
        .start-button {
            transition: transform 0.1s ease-out, box-shadow 0.1s ease-out;
        }
        .start-button:active {
            transform: scale(0.98);
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
    </style>
</head>
<body class="flex flex-col items-center justify-center h-screen text-white p-8">

    <div class="text-center">
        <h1 class="text-6xl md:text-8xl font-bold mb-8 animate-bounce">
            å•è¯é—¯å…³
        </h1>

        <!-- æ¸¸æˆæ¨¡å¼é€‰æ‹© -->
        <div class="space-y-4 mb-6">
            <button id="singlePlayerButton"
                    class="start-button bg-white text-indigo-600 font-bold text-2xl md:text-3xl py-5 px-12 rounded-lg shadow-xl hover:bg-gray-100 focus:outline-none focus:ring-4 focus:ring-indigo-300 w-80 transition duration-150 ease-in-out">
                ğŸ¯ å•äººæŒ‘æˆ˜
            </button>

            <button id="multiPlayerButton"
                    class="start-button bg-blue-500 text-white font-bold text-2xl md:text-3xl py-5 px-12 rounded-lg shadow-xl hover:bg-blue-600 focus:outline-none focus:ring-4 focus:ring-blue-300 w-80 transition duration-150 ease-in-out">
                âš”ï¸ åŒäººå¯¹æˆ˜
            </button>
        </div>

        <!-- ç½‘ç»œçŠ¶æ€æç¤º -->
        <div id="networkStatus" class="mt-4 text-sm opacity-75">
            <span id="networkIndicator">ğŸŒ</span>
            <span id="networkText">æ£€æŸ¥ç½‘ç»œçŠ¶æ€...</span>
        </div>
    </div>

    <!-- ç®¡ç†å‘˜å…¥å£å›¾æ ‡ -->
    <div id="adminEntryIconContainerWelcome" class="admin-icon" style="position: absolute; top: 20px; right: 20px; cursor: pointer; z-index: 1000;">
         <!-- ä½¿ç”¨ Lucide Settings Icon -->
         <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-settings"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 .54 1.85l-.01.45a2 2 0 0 1-1 1.74l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 .54 1.85l-.01.45a2 2 0 0 1-1 1.74l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 .54 1.85v.19a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.38a2 2 0 0 0-.73-2.73l-.15-.1a2 2 0 0 1-.54-1.85l.01-.45a2 2 0 0 1 1-1.74l.43.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l-.22.38a2 2 0 0 0-.73-2.73l-.15-.1a2 2 0 0 1-.54-1.85v-.19a2 2 0 0 0-2-2h-.44Z"/><circle cx="12" cy="12" r="3"/></svg>
    </div>

    <script>
        // let welcomeMessageSent = false; // Flag is no longer needed
        // Remove the load event listener as it might cause flickering
        /*
        window.addEventListener('load', () => {
            // é€šçŸ¥çˆ¶é¡µé¢å½“å‰æ˜¯ welcome å±ï¼Œè®©çˆ¶é¡µé¢æ˜¾ç¤ºç®¡ç†å‘˜å›¾æ ‡
            if (!welcomeMessageSent && window.parent && window.parent.postMessage) {
                window.parent.postMessage({ action: 'navigate', screen: 'welcome' }, '*');
                welcomeMessageSent = true; // Set flag after sending
            }
        });
        */

        const singlePlayerButton = document.getElementById('singlePlayerButton');
        const multiPlayerButton = document.getElementById('multiPlayerButton');
        const networkIndicator = document.getElementById('networkIndicator');
        const networkText = document.getElementById('networkText');

        // æ£€æŸ¥ç½‘ç»œçŠ¶æ€
        function updateNetworkStatus() {
            const isOnline = navigator.onLine;
            if (isOnline) {
                networkIndicator.textContent = 'âœ…';
                networkText.textContent = 'ç½‘ç»œè¿æ¥æ­£å¸¸';
                singlePlayerButton.disabled = false;
                multiPlayerButton.disabled = false;
                singlePlayerButton.classList.remove('opacity-50', 'cursor-not-allowed');
                multiPlayerButton.classList.remove('opacity-50', 'cursor-not-allowed');
            } else {
                networkIndicator.textContent = 'âŒ';
                networkText.textContent = 'ç½‘ç»œè¿æ¥ä¸å¯ç”¨';
                singlePlayerButton.disabled = true;
                multiPlayerButton.disabled = true;
                singlePlayerButton.classList.add('opacity-50', 'cursor-not-allowed');
                multiPlayerButton.classList.add('opacity-50', 'cursor-not-allowed');
            }
        }

        // åˆå§‹æ£€æŸ¥ç½‘ç»œçŠ¶æ€
        updateNetworkStatus();

        // ç›‘å¬ç½‘ç»œçŠ¶æ€å˜åŒ–
        window.addEventListener('online', updateNetworkStatus);
        window.addEventListener('offline', updateNetworkStatus);

        // é€šç”¨çš„éŸ³é¢‘åˆå§‹åŒ–å’Œç‚¹å‡»å¤„ç†å‡½æ•°
        async function handleButtonClick() {
            // æ£€æŸ¥ç½‘ç»œçŠ¶æ€
            if (!navigator.onLine) {
                alert('ç½‘ç»œè¿æ¥ä¸å¯ç”¨ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥åé‡è¯•ã€‚');
                return false;
            }

            try {
                // å°è¯•åˆå§‹åŒ– AudioContext (å¿…é¡»åœ¨ç”¨æˆ·äº¤äº’å)
                if (window.parent && typeof window.parent.initAudioContext === 'function') {
                    await window.parent.initAudioContext(); // Wait for initialization/resume
                    // å¦‚æœåˆå§‹åŒ–æˆåŠŸï¼Œå°è¯•é¢„åŠ è½½éŸ³æ•ˆ
                    if (window.parent && typeof window.parent.preloadSounds === 'function') {
                        await window.parent.preloadSounds(); // Wait for preloading
                    }
                } else {
                    console.warn('initAudioContext or preloadSounds function not found in parent.');
                }
            } catch (error) {
                console.error("Audio initialization/preload failed on button click:", error);
            }

            // æ’­æ”¾ç‚¹å‡»éŸ³æ•ˆ (å¦‚æœ audio.js å·²å®ç°ä¸”éŸ³æ•ˆå·²åŠ è½½)
            if (window.parent && typeof window.parent.playSound === 'function') {
                window.parent.playSound('click');
            }

            return true;
        }

        // å•äººæŒ‘æˆ˜æŒ‰é’®äº‹ä»¶
        singlePlayerButton.addEventListener('click', async () => {
            const canProceed = await handleButtonClick();
            if (!canProceed) return;

            // é€šçŸ¥çˆ¶é¡µé¢å¯¼èˆªåˆ° info_input å±å¹• (ä¿æŒåŸæœ‰å•äººæ¨¡å¼æµç¨‹)
            if (window.parent && window.parent.postMessage) {
                window.parent.postMessage({ action: 'navigate', screen: 'info_input' }, '*');
            } else {
                console.error("æ— æ³•ä¸çˆ¶çª—å£é€šä¿¡ä»¥è¿›è¡Œå¯¼èˆªã€‚");
            }
        });

        // åŒäººå¯¹æˆ˜æŒ‰é’®äº‹ä»¶
        multiPlayerButton.addEventListener('click', async () => {
            const canProceed = await handleButtonClick();
            if (!canProceed) return;

            // é€šçŸ¥çˆ¶é¡µé¢å¯¼èˆªåˆ°åŒäººå¯¹æˆ˜ä¿¡æ¯è¾“å…¥é¡µé¢
            if (window.parent && window.parent.postMessage) {
                window.parent.postMessage({ action: 'navigate', screen: 'battle_info_input' }, '*');
            } else {
                console.error("æ— æ³•ä¸çˆ¶çª—å£é€šä¿¡ä»¥è¿›è¡Œå¯¼èˆªã€‚");
            }
        });

        // ç®¡ç†å‘˜å…¥å£å›¾æ ‡é€»è¾‘
        const adminIconElement = document.getElementById('adminEntryIconContainerWelcome');
        if (adminIconElement) {
            adminIconElement.addEventListener('click', function() {
                // æ’­æ”¾ç‚¹å‡»éŸ³æ•ˆ (å¦‚æœ audio.js å·²å®ç°ä¸”éŸ³æ•ˆå·²åŠ è½½)
                if (window.parent && typeof window.parent.playSound === 'function') {
                    window.parent.playSound('click');
                }
                // é€šçŸ¥çˆ¶é¡µé¢å¯¼èˆªåˆ° admin_login å±å¹•
                if (window.parent && window.parent.postMessage) {
                    window.parent.postMessage({ type: 'navigate', screen: 'admin_login' }, '*');
                } else {
                    console.error("æ— æ³•ä¸çˆ¶çª—å£é€šä¿¡ä»¥å¯¼èˆªåˆ°ç®¡ç†å‘˜ç™»å½•é¡µé¢ã€‚");
                }
            });
        }

        // ç¡®ä¿ Lucide å›¾æ ‡è¢«åˆ›å»º
        // DOMContentLoaded å¯èƒ½å·²ç»è§¦å‘ï¼Œæˆ–è€…å¯¹äº iframe æ¥è¯´è¡Œä¸ºå¯èƒ½ä¸åŒ
        // ç›´æ¥è°ƒç”¨æˆ–ç¡®ä¿åœ¨è„šæœ¬æœ«å°¾è°ƒç”¨
        if (typeof lucide !== 'undefined' && typeof lucide.createIcons === 'function') {
            lucide.createIcons();
        } else {
            // å¦‚æœ lucide æœªå®šä¹‰ï¼Œå¯ä»¥å°è¯•åœ¨ window load æ—¶å†æ¬¡å°è¯•ï¼Œæˆ–è€…æç¤ºé”™è¯¯
            window.addEventListener('load', () => {
                if (typeof lucide !== 'undefined' && typeof lucide.createIcons === 'function') {
                    lucide.createIcons();
                } else {
                    console.error('Lucide library not loaded on welcome.html');
                }
            });
        }
    </script>
</body>
</html>